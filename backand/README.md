# CryptoScan - Система анализа объемов криптовалют

Система для мониторинга и анализа торговых объемов криптовалютных пар на бирже Bybit с генерацией алертов и уведомлений.

## Структура проекта

```
criptoscan/
├── settings.py              # Управление настройками и .env файлом
├── main.py                  # Главный файл приложения FastAPI
├── .env.example            # Пример файла настроек
├── README.md               # Документация
│
├── core/                   # Основные модули системы
│   ├── __init__.py
│   ├── core_logger.py      # Централизованная система логирования
│   ├── core_exceptions.py  # Пользовательские исключения
│   └── core_utils.py       # Утилиты общего назначения
│
├── database/               # Модули для работы с базой данных
│   ├── __init__.py
│   ├── database_connection.py  # Управление подключениями к БД
│   ├── database_tables.py      # Создание и управление таблицами
│   └── database_queries.py     # Запросы к базе данных
│
├── alert/                  # Модули для работы с алертами
│   ├── __init__.py
│   ├── alert_manager.py    # Главный менеджер алертов
│   ├── alert_types.py      # Типы и структуры данных алертов
│   ├── alert_validators.py # Валидаторы алертов
│   └── alert_imbalance.py  # Анализатор имбалансов Smart Money
│
├── bybit/                  # Модули для работы с Bybit API
│   ├── __init__.py
│   ├── bybit_websocket.py  # WebSocket клиент для Bybit
│   └── bybit_rest_api.py   # REST API клиент для Bybit
│
├── times/                  # Модули синхронизации времени
│   ├── __init__.py
│   ├── times_manager.py        # Главный менеджер времени
│   ├── times_server_sync.py    # Синхронизация с серверами времени
│   └── times_exchange_sync.py  # Синхронизация с биржей
│
├── filter/                 # Модули фильтрации торговых пар
│   ├── __init__.py
│   └── filter_price.py     # Фильтр по изменению цены
│
├── telegram/               # Модули для работы с Telegram
│   ├── __init__.py
│   └── telegram_bot.py     # Telegram бот для уведомлений
│
├── social/                 # Модули анализа социальных настроений
│   ├── __init__.py
│   └── social_analyzer.py  # Анализатор социальных настроений
│
├── trading/                # Модули для торговли
│   ├── __init__.py
│   └── trading_api.py      # API для реальной торговли
│
└── websocket/              # Модули для WebSocket соединений
    ├── __init__.py
    └── websocket_manager.py # Менеджер WebSocket соединений
```

## Основные компоненты

### Core (Ядро системы)
- **core_logger.py** - Централизованная система логирования
- **core_exceptions.py** - Пользовательские исключения
- **core_utils.py** - Утилиты общего назначения

### Database (База данных)
- **database_connection.py** - Управление подключениями к PostgreSQL
- **database_tables.py** - Создание и управление таблицами
- **database_queries.py** - Выполнение запросов к БД

### Alert (Алерты)
- **alert_manager.py** - Главный менеджер алертов
- **alert_types.py** - Типы и структуры данных алертов
- **alert_validators.py** - Валидация алертов
- **alert_imbalance.py** - Анализ имбалансов Smart Money

### Bybit (Интеграция с биржей)
- **bybit_websocket.py** - WebSocket клиент для получения данных
- **bybit_rest_api.py** - REST API клиент для запросов

### Times (Синхронизация времени)
- **times_manager.py** - Главный менеджер времени
- **times_server_sync.py** - Синхронизация с серверами точного времени
- **times_exchange_sync.py** - Синхронизация с биржей

## Установка и настройка

1. **Клонирование репозитория**
```bash
git clone <repository-url>
cd criptoscan
```

2. **Установка зависимостей**
```bash
pip install -r requirements.txt
```

3. **Настройка базы данных**
```bash
# Создайте базу данных PostgreSQL
createdb cryptoscan
```

4. **Настройка конфигурации**
```bash
# Скопируйте пример файла настроек
cp .env.example .env

# Отредактируйте .env файл с вашими настройками
nano .env
```

5. **Запуск приложения**
```bash
python main.py
```

## Настройки (.env файл)

### Основные настройки
- `SERVER_HOST` - Хост сервера (по умолчанию: 0.0.0.0)
- `SERVER_PORT` - Порт сервера (по умолчанию: 8000)

### База данных
- `DATABASE_URL` - URL подключения к PostgreSQL
- `DB_HOST`, `DB_PORT`, `DB_NAME`, `DB_USER`, `DB_PASSWORD` - Параметры подключения

### Анализ объемов
- `VOLUME_MULTIPLIER` - Множитель превышения объема (по умолчанию: 2.0)
- `MIN_VOLUME_USDT` - Минимальный объем в USDT (по умолчанию: 1000)
- `CONSECUTIVE_LONG_COUNT` - Количество подряд идущих LONG свечей (по умолчанию: 5)

### Telegram уведомления
- `TELEGRAM_BOT_TOKEN` - Токен Telegram бота
- `TELEGRAM_CHAT_ID` - ID чата для уведомлений

### Bybit API (для реальной торговли)
- `BYBIT_API_KEY` - API ключ Bybit
- `BYBIT_API_SECRET` - Секретный ключ Bybit

## API Endpoints

### Основные
- `GET /api/stats` - Статистика системы
- `GET /api/time` - Информация о времени биржи
- `GET /api/settings` - Текущие настройки
- `POST /api/settings` - Обновление настроек

### Watchlist
- `GET /api/watchlist` - Список торговых пар
- `POST /api/watchlist` - Добавить пару в watchlist
- `DELETE /api/watchlist/{id}` - Удалить пару из watchlist

### WebSocket
- `WS /ws` - WebSocket соединение для получения обновлений в реальном времени

## Типы алертов

1. **Volume Spike** - Превышение объема торгов
2. **Consecutive Long** - Подряд идущие LONG свечи
3. **Priority** - Комбинированный сигнал (объем + последовательность)

## Анализ имбалансов Smart Money

Система поддерживает анализ следующих типов имбалансов:
- **Fair Value Gap (FVG)** - Гэпы справедливой стоимости
- **Order Block (OB)** - Блоки ордеров
- **Breaker Block (BB)** - Пробитые блоки

## Мониторинг и логирование

Система использует централизованное логирование с настраиваемыми уровнями:
- `DEBUG` - Детальная отладочная информация
- `INFO` - Общая информация о работе системы
- `WARNING` - Предупреждения
- `ERROR` - Ошибки

Логи сохраняются в файл, указанный в настройке `LOG_FILE`.

## Безопасность

- Все API ключи хранятся в .env файле
- Подключение к базе данных использует пул соединений
- WebSocket соединения автоматически очищаются при отключении

## Производительность

- Асинхронная архитектура для высокой производительности
- Кэширование для уменьшения нагрузки на API
- Пакетная обработка данных
- Автоматическая очистка старых данных

## Разработка

Для разработки рекомендуется:
1. Использовать виртуальное окружение Python
2. Следовать структуре модулей
3. Добавлять логирование в новые функции
4. Использовать типизацию (type hints)
5. Обрабатывать исключения

## Поддержка

При возникновении проблем:
1. Проверьте логи в файле, указанном в `LOG_FILE`
2. Убедитесь в правильности настроек в .env файле
3. Проверьте подключение к базе данных
4. Проверьте доступность API Bybit

## Лицензия

[Укажите лицензию проекта]